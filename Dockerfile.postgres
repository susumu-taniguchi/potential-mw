FROM postgres:12.6

RUN chown -R postgres:postgres /var/lib/postgresql

RUN chmod 777 /var/lib/postgresql
RUN chmod 777 /var/lib/postgresql/data

ENV PGDATA /var/lib/postgresql/data/pgdata
# this 777 will be replaced by 700 at runtime (allows semi-arbitrary "--user" values)
RUN mkdir -p "$PGDATA" && chown -R postgres:postgres "$PGDATA" && chmod 777 "$PGDATA"

USER postgres

EXPOSE 5432
CMD ["postgres"]
